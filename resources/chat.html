<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Document</title>
    </head>

    <body>
        <style>
            * {
                color: white;
            }

            body {
                background-color: black;
            }
            #chat-window {
                border: 1px solid grey;
                width: 30rem;
                height: 60rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                overflow-y: scroll;
            }

            textarea, button {
                color: black;
            }
        </style>

        <h1>Under Construction</h1>

        <div id="chat-window"></div>

        <form action="/message" method="post">
            <textarea name="message" id="message"></textarea>

            <button type="submit">Send</button>
        </form>

        <script>
            const chat_window = document.querySelector('#chat-window');

            async function get_new_message() {
                let response = await fetch(`${window.location.origin}/new-message`);
                const message_text = await response.text();
                const message_json = JSON.parse(message_text);

                let new_p = document.createElement('p');
                let new_node = document.createTextNode(message_json.message);

                new_p.style.width = "80%";
                new_p.style.border = "1px solid grey";
                new_p.style.borderRadius = "4px";
                new_p.style.padding = "0.25em";

                new_p.appendChild(new_node);
                chat_window.appendChild(new_p);

                new_p.scrollIntoView();
            }

            const message_recv = setInterval(get_new_message, 50);


            const textarea = document.querySelector('textarea');

            document.querySelector('button[type="submit"]').addEventListener('click', e => {
                e.preventDefault();

                fetch(`${window.location.origin}/message`, {
                    method: "post",
                    body: textarea.value,
                });

                textarea.value = "";
            });
        </script>
    </body>
</html>
